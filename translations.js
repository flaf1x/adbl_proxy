const translations = {
  ru: {
    appTitle: "ABDL Proxy Manager",
    statusEnabled: "–í–∫–ª—é—á–µ–Ω",
    statusDisabled: "–û—Ç–∫–ª—é—á–µ–Ω",
    yourIpAddress: "–í–∞—à IP –∞–¥—Ä–µ—Å",
    loading: "–ó–∞–≥—Ä—É–∑–∫–∞...",
    failedToGetIp: "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å IP",
    copyIp: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å IP",
    ipCopied: "IP —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!",
    locationUnknown: "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",
    locationUnavailable: "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ",
    failedToDetermine: "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å",
    quickAdd: "–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ",
    addToWhitelist: "–î–æ–±–∞–≤–∏—Ç—å –≤ –≤–∞–π—Ç–ª–∏—Å—Ç",
    tabHome: "–ì–ª–∞–≤–Ω–∞—è",
    tabWhitelist: "–í–∞–π—Ç–ª–∏—Å—Ç",
    tabConfigs: "–ö–æ–Ω—Ñ–∏–≥–∏ –ø—Ä–æ–∫—Å–∏",
    tabSettings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
    activeConfig: "–ê–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥",
    noConfigs: "–ù–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π",
    clickPlusToAdd: "–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥ –≤–æ –≤–∫–ª–∞–¥–∫–µ \"–ö–æ–Ω—Ñ–∏–≥–∏ –ø—Ä–æ–∫—Å–∏\" –Ω–∞–∂–∞–≤ –Ω–∞ \"+\"",
    selectConfig: "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é",
    sitesWithoutProxy: "–°–∞–π—Ç—ã –±–µ–∑ –ø—Ä–æ–∫—Å–∏",
    addManually: "–î–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é",
    listEmpty: "–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç",
    configManagement: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏",
    addConfig: "–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥",
    extensionSettings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è",
    themeTitle: "–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è",
    themeDescription: "–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",
    themeSystem: "–°–∏—Å—Ç–µ–º–Ω–∞—è",
    themeLight: "–°–≤–µ—Ç–ª–∞—è",
    themeDark: "–¢—ë–º–Ω–∞—è",
    languageTitle: "–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",
    languageDescription: "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è",
    languageSystem: "–°–∏—Å—Ç–µ–º–Ω—ã–π",
    languageRussian: "–†—É—Å—Å–∫–∏–π",
    languageEnglish: "English",
    hideIpTitle: "–°–∫—Ä—ã–≤–∞—Ç—å IP –∞–¥—Ä–µ—Å",
    hideIpDescription: "–í–∫–ª—é—á–∏—Ç—å —Å–∫—Ä—ã—Ç–∏–µ IP –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥ —Å–ø–æ–π–ª–µ—Ä–æ–º",
    bypassLocalTitle: "–û–±—Ö–æ–¥–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å",
    bypassLocalDescription: "–ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤",
    newConfig: "–ù–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥",
    editConfig: "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥",
    configName: "–ù–∞–∑–≤–∞–Ω–∏–µ",
    configHost: "–•–æ—Å—Ç",
    configPort: "–ü–æ—Ä—Ç",
    configScheme: "–ü—Ä–æ—Ç–æ–∫–æ–ª",
    configNamePlaceholder: "–ú–æ–π –ø—Ä–æ–∫—Å–∏",
    cancel: "–û—Ç–º–µ–Ω–∞",
    save: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
    addToWhitelistTitle: "–î–æ–±–∞–≤–∏—Ç—å –≤ –≤–∞–π—Ç–ª–∏—Å—Ç",
    domainOrPattern: "–î–æ–º–µ–Ω –∏–ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω",
    domainPlaceholder: "example.com",
    domainHint: "–ü—Ä–∏–º–µ—Ä—ã: example.com, *.example.com, 192.168.1.1",
    add: "–î–æ–±–∞–≤–∏—Ç—å",
    enterDomain: "–í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω",
    invalidDomainChars: "–î–æ–º–µ–Ω –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, —Ç–æ—á–∫–∏ –∏ –¥–µ—Ñ–∏—Å—ã",
    domainInvalidChars: "–î–æ–º–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã",
    deleteConfigTitle: "–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é?",
    deleteConfigMessage: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é",
    cannotUndo: "–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.",
    delete: "–£–¥–∞–ª–∏—Ç—å",
    edit: "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å",
    close: "–ó–∞–∫—Ä—ã—Ç—å",
    http: "HTTP",
    https: "HTTPS",
    socks4: "SOCKS4",
    socks5: "SOCKS5",
    credits: "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏",
    creditsText: "–°–æ–∑–¥–∞–Ω–æ —Å <3 –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏üçº",
    githubRepo: "GitHub —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è",
    creatorSite: "–°–∞–π—Ç —Ñ–ª–∞—Ñ–∏–∫—Å–∞ :3",
    secondSite: "–±–µ–±–µ–±–µ"
  },
  en: {
    appTitle: "ABDL Proxy Manager",
    statusEnabled: "Enabled",
    statusDisabled: "Disabled",
    yourIpAddress: "Your IP Address",
    loading: "Loading...",
    failedToGetIp: "Failed to get IP",
    copyIp: "Copy IP",
    ipCopied: "IP copied!",
    locationUnknown: "Location unknown",
    locationUnavailable: "Location unavailable",
    failedToDetermine: "Failed to determine",
    quickAdd: "Quick Add",
    addToWhitelist: "Add to Whitelist",
    tabHome: "Home",
    tabWhitelist: "Whitelist",
    tabConfigs: "Proxy Configs",
    tabSettings: "Settings",
    activeConfig: "Active Config",
    noConfigs: "No Configurations",
    clickPlusToAdd: "Create a config in \"Proxy Configs\" tab by clicking \"+\"",
    selectConfig: "Select Configuration",
    sitesWithoutProxy: "Sites Without Proxy",
    addManually: "Add Manually",
    listEmpty: "List is Empty",
    configManagement: "Configuration Management",
    addConfig: "Add Config",
    extensionSettings: "Extension Settings",
    themeTitle: "Theme",
    themeDescription: "Select interface color scheme",
    themeSystem: "System",
    themeLight: "Light",
    themeDark: "Dark",
    languageTitle: "Interface Language",
    languageDescription: "Select extension language",
    languageSystem: "System",
    languageRussian: "–†—É—Å—Å–∫–∏–π",
    languageEnglish: "English",
    hideIpTitle: "Hide IP Address",
    hideIpDescription: "Enable IP and location hiding under spoiler",
    bypassLocalTitle: "Bypass Local Network",
    bypassLocalDescription: "Don't use proxy for local addresses",
    newConfig: "New Config",
    editConfig: "Edit Config",
    configName: "Name",
    configHost: "Host",
    configPort: "Port",
    configScheme: "Protocol",
    configNamePlaceholder: "My Proxy",
    cancel: "Cancel",
    save: "Save",
    addToWhitelistTitle: "Add to Whitelist",
    domainOrPattern: "Domain or Pattern",
    domainPlaceholder: "example.com",
    domainHint: "Examples: example.com, *.example.com, 192.168.1.1",
    add: "Add",
    enterDomain: "Enter domain",
    invalidDomainChars: "Domain can only contain Latin letters, numbers, dots and hyphens",
    domainInvalidChars: "Domain contains invalid characters",
    deleteConfigTitle: "Delete Configuration?",
    deleteConfigMessage: "Are you sure you want to delete configuration",
    cannotUndo: "This action cannot be undone.",
    delete: "Delete",
    edit: "Edit",
    close: "Close",
    http: "HTTP",
    https: "HTTPS",
    socks4: "SOCKS4",
    socks5: "SOCKS5",
    credits: "Credits",
    creditsText: "Created with <3 for convenient proxy managementüçº",
    githubRepo: "GitHub extension",
    creatorSite: "Flaf1x Website :3",
    secondSite: "bebebe"
  }
};
function getCurrentLanguage() {
  return new Promise((resolve) => {
    chrome.storage.sync.get(['language'], (result) => {
      const language = result.language || 'system';
      if (language === 'system') {
        const systemLang = navigator.language || navigator.userLanguage;
        const langCode = systemLang.split('-')[0]; // 'ru-RU' -> 'ru'
        resolve(translations[langCode] ? langCode : 'en');
      } else {
        resolve(language);
      }
    });
  });
}
function t(key) {
  const lang = document.documentElement.lang || 'ru';
  return translations[lang]?.[key] || translations['en']?.[key] || key;
}
async function setLanguage(lang) {
  let targetLang = lang;
  if (lang === 'system') {
    const systemLang = navigator.language || navigator.userLanguage;
    const langCode = systemLang.split('-')[0];
    targetLang = translations[langCode] ? langCode : 'en';
  }
  document.documentElement.lang = targetLang;
  await updateAllTranslations();
}
async function updateAllTranslations() {
  const lang = document.documentElement.lang;
  const trans = translations[lang];
  
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    if (trans[key]) {
      element.textContent = trans[key];
    }
  });
  
  const title = document.querySelector('.title');
  if (title) title.textContent = trans.appTitle;
  const statusText = document.getElementById('statusText');
  if (statusText) {
    const isEnabled = statusText.textContent.includes('Enabled') || statusText.textContent.includes('–í–∫–ª—é—á–µ–Ω');
    statusText.textContent = isEnabled ? trans.statusEnabled : trans.statusDisabled;
  }
  const ipLabel = document.querySelector('.ip-label span:last-child');
  if (ipLabel) ipLabel.textContent = trans.yourIpAddress;
  const copyIpBtn = document.getElementById('copyIpBtn');
  if (copyIpBtn) copyIpBtn.title = trans.copyIp;
  const quickAddHeader = document.querySelector('.quick-add-header span:last-child');
  if (quickAddHeader) quickAddHeader.textContent = trans.quickAdd;
  const addToWhitelistBtn = document.querySelector('#addToWhitelistBtn span:last-child');
  if (addToWhitelistBtn) addToWhitelistBtn.textContent = trans.addToWhitelist;
  const navTabs = document.querySelectorAll('.nav-tab');
  if (navTabs[0]) navTabs[0].querySelector('span:last-child').textContent = trans.tabHome;
  if (navTabs[1]) navTabs[1].querySelector('span:last-child').textContent = trans.tabWhitelist;
  if (navTabs[2]) navTabs[2].querySelector('span:last-child').textContent = trans.tabConfigs;
  if (navTabs[3]) navTabs[3].querySelector('span:last-child').textContent = trans.tabSettings;
  const proxyTitle = document.querySelector('#proxy-panel .panel-title');
  if (proxyTitle) proxyTitle.textContent = trans.activeConfig;
  const whitelistTitle = document.querySelector('#whitelist-panel .panel-title');
  if (whitelistTitle) whitelistTitle.textContent = trans.sitesWithoutProxy;
  const configsTitle = document.querySelector('#configs-panel .panel-title');
  if (configsTitle) configsTitle.textContent = trans.configManagement;
  const settingsTitle = document.querySelector('#settings-panel .panel-title');
  if (settingsTitle) settingsTitle.textContent = trans.extensionSettings;
  
  const configNameLabel = document.querySelector('label[for="configName"]');
  if (configNameLabel) configNameLabel.textContent = trans.configName;
  const configHostLabel = document.querySelector('label[for="configHost"]');
  if (configHostLabel) configHostLabel.textContent = trans.configHost;
  const configPortLabel = document.querySelector('label[for="configPort"]');
  if (configPortLabel) configPortLabel.textContent = trans.configPort;
  const configSchemeLabel = document.querySelector('label[for="configScheme"]');
  if (configSchemeLabel) configSchemeLabel.textContent = trans.configScheme;
  const configNameInput = document.getElementById('configName');
  if (configNameInput) configNameInput.placeholder = trans.configNamePlaceholder;
  const whitelistDomainInput = document.getElementById('whitelistDomain');
  if (whitelistDomainInput) whitelistDomainInput.placeholder = trans.domainPlaceholder;
  const cancelBtns = document.querySelectorAll('.btn-secondary');
  cancelBtns.forEach(btn => {
    if (btn.textContent.includes('–û—Ç–º–µ–Ω–∞') || btn.textContent.includes('Cancel')) {
      btn.textContent = trans.cancel;
    }
  });
  const saveBtn = document.getElementById('saveConfig');
  if (saveBtn) saveBtn.textContent = trans.save;
  const saveWhitelistBtn = document.getElementById('saveWhitelist');
  if (saveWhitelistBtn) saveWhitelistBtn.textContent = trans.add;
  const confirmDeleteBtn = document.getElementById('confirmDelete');
  if (confirmDeleteBtn) confirmDeleteBtn.textContent = trans.delete;
  const whitelistModalTitle = document.querySelector('#whitelistModal h2');
  if (whitelistModalTitle) whitelistModalTitle.textContent = trans.addToWhitelistTitle;
  const deleteModalTitle = document.querySelector('#deleteConfirmModal h2');
  if (deleteModalTitle) deleteModalTitle.textContent = trans.deleteConfigTitle;
  const domainLabel = document.querySelector('label[for="whitelistDomain"]');
  if (domainLabel) domainLabel.textContent = trans.domainOrPattern;
  const domainHint = document.querySelector('.hint');
  if (domainHint) domainHint.textContent = trans.domainHint;
  const addWhitelistManual = document.getElementById('addWhitelistManual');
  if (addWhitelistManual) addWhitelistManual.title = trans.addManually;
  const addConfigBtn = document.getElementById('addConfigBtn');
  if (addConfigBtn) addConfigBtn.title = trans.addConfig;
  
  if (window.updateUI) {
    await window.updateUI();
  }
}
